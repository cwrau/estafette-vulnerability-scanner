FROM docker:19.03.5

LABEL maintainer="estafette.io" \
      description="The estafette-vulnerability-scanner regularly scans all containers in a Kubernetes cluster for vulnerabilities"

RUN \
    # fix vulnerability
    apk update \
    && apk add --no-cache --upgrade \
        openssl \
    && rm -rf /var/cache/apk/* \
    # get trivy and download db
    && wget -O- https://github.com/aquasecurity/trivy/releases/download/v0.4.1/trivy_0.4.1_Linux-64bit.tar.gz | \
    tar -xzf - -C / \
    && /trivy --version \
    && /trivy --light --no-progress --download-db-only --cache-dir /trivy-cache

COPY estafette-vulnerability-scanner /

ENTRYPOINT ["/estafette-vulnerability-scanner"]