FROM alpine:3.11

ARG TRIVY_VERSION=0.5.2

RUN wget -O- https://github.com/aquasecurity/trivy/releases/download/v${TRIVY_VERSION}/trivy_${TRIVY_VERSION}_Linux-64bit.tar.gz | \
    tar -xzf - -C / \
    && /trivy --version \
    && /trivy --light --no-progress --download-db-only --cache-dir /trivy-cache

FROM scratch

LABEL maintainer="estafette.io" \
      description="The estafette-vulnerability-scanner regularly scans all containers in a Kubernetes cluster for vulnerabilities"

COPY ca-certificates.crt /etc/ssl/certs/
COPY estafette-vulnerability-scanner /
COPY --from=0 /trivy /trivy
COPY --from=0 /trivy-cache /trivy-cache

ENTRYPOINT ["/estafette-vulnerability-scanner"]